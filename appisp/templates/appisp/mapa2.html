{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        window.ICON_URLS = {
            'Transporte': '{% static "img/icones/transporte.png" %}',
            'Switch': '{% static "img/icones/sw.png" %}',
            'Passivo': '{% static "img/icones/passivo.png" %}',
            'Servidor': '{% static "img/icones/servidor.png" %}',
            'VMWARE': '{% static "img/icones/vm.png" %}',
            'Olt': '{% static "img/icones/olt.png" %}',
            'Impressora': '{% static "img/icones/printer.png" %}',
            'Telefone': '{% static "img/icones/telefone.png" %}',
            'Computador': '{% static "img/icones/computador.png" %}',
            'Roteador': '{% static "img/icones/route.png" %}',
            'default': '{% static "img/icones/defull.png" %}'
        };
    </script>

    <link rel="stylesheet" href="{% static 'appisp/css/mapa.css' %}">
{% endblock %}

{% block content %}
    {% csrf_token %}
    <!-- Controles do Topo -->
    <div style="display: flex; align-items: center; gap: 10px; margin: 10px;">
        <select id="empresa-selector">
            <option value="">Selecione uma Empresa</option>
            {% for empresa in empresas %}
            <option value="{{ empresa.id }}">{{ empresa.nome }}</option>
            {% endfor %}
        </select>
        <a href="/admin/" class="btn btn-primary" style="width: -webkit-fill-available;">FECHAR O MAPA</a>
    </div>
    <div style="display: flex; align-items: center; gap: 10px; margin: 10px;">
        <label for="zoom-slider">Zoom:</label>
        <input type="range" id="zoom-slider" min="0.5" max="3" step="0.1" value="1" style="width: 200px;">
    </div>

    <!-- Contêiner onde o mapa será renderizado -->
    <div id="map-container"></div>

    <!-- Overlay para escurecer o fundo quando um modal está aberto -->
    <div id="modalOverlay" class="modal-overlay"></div>

    <!-- Modal para Editar Equipamento -->
    <div id="modalEquipamento" class="modal-custom">
        <div class="modal-header">
            <h5 id="modalTitle">Editar Equipamento</h5>
            <button type="button" id="closeModal" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="equipamentoId">
            <div class="form-group"><label>Nome:</label><input type="text" id="nome" class="form-control"></div>
            <div class="form-group"><label>Tipo:</label><input type="text" id="tipo" class="form-control"></div>
            <div class="form-group"><label>IP:</label><input type="text" id="ip" class="form-control"></div>
            <div class="form-group"><label>Usuário:</label><input type="text" id="usuario" class="form-control"></div>
            <div class="form-group"><label>Senha:</label><input type="password" id="senha" class="form-control"></div>
            <div class="form-group"><label>Status:</label><input type="text" id="status" class="form-control"></div>
        </div>
        <div class="modal-footer">
            <button type="button" id="salvarEquipamento" class="btn btn-primary">Salvar</button>
        </div>
    </div>

    <!-- Modal para Conectar Portas -->
    <div id="portaModal" class="modal-custom" style="display: none;">
        <div class="modal-header">
            <h5>Conectar Portas</h5>
            <button type="button" id="closeModalConexao" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="porta-dropdown">Porta de Origem:</label>
                <select id="porta-dropdown" class="form-control"></select>
            </div>
            <div class="form-group">
                <label for="equipamento-dropdown">Equipamento de Destino:</label>
                <select id="equipamento-dropdown" class="form-control"></select>
            </div>
            <div class="form-group">
                <label for="porta-destino-dropdown">Porta de Destino:</label>
                <select id="porta-destino-dropdown" class="form-control"></select>
            </div>
            <div class="form-group">
                <label for="observacao">Observação:</label>
                <!-- O CKEditor será anexado a este textarea -->
                <textarea id="observacao" class="form-control"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button id="conectar" class="btn btn-success">Conectar</button>
        </div>
    </div>

    <!-- Modal para Exibir Informações da Conexão -->
    <div id="modalConexao" class="modal-custom" style="display: none;">
        <div class="modal-conexao-header"></div>
        <div class="modal-conexao-body"></div>
        <div class="modal-footer">
            <button id="excluirConexaoBtn" class="btn btn-danger">Excluir</button>
        </div>
    </div>

{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>
    <script type="module" src="{% static 'appisp/js/mapa.js' %}"></script>
{% endblock %}